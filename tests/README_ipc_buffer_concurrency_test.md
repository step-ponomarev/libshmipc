# IPC Buffer Concurrency Tests

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
–¢–µ—Å—Ç—ã –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è `ipc_buffer.h` - –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã IPC –±—É—Ñ–µ—Ä–æ–≤ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞.

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–æ–≤
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ IPC –±—É—Ñ–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã –¥–ª—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç race conditions, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø.

## üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤
**16 —Ç–µ—Å—Ç–æ–≤** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## üîß –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### **1. –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ—Å—Ç—É–ø–∞**
- **Single Writer, Single Reader** - –æ–¥–∏–Ω –ø–∏—Å–∞—Ç–µ–ª—å, –æ–¥–∏–Ω —á–∏—Ç–∞—Ç–µ–ª—å
- **Multiple Writer, Single Reader** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∏—Å–∞—Ç–µ–ª–µ–π, –æ–¥–∏–Ω —á–∏—Ç–∞—Ç–µ–ª—å  
- **Multiple Writer, Multiple Reader** - –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∏—Å–∞—Ç–µ–ª–µ–π, –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π

### **2. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**
- **Delayed Multiple Writer, Multiple Reader** - —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- **Race Between Skip and Read** - –≥–æ–Ω–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–ø—É—Å–∫–æ–º –∏ —á—Ç–µ–Ω–∏–µ–º
- **Multiple Threads Reserve and Commit** - –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Race Between Reserve and Commit** - –≥–æ–Ω–∫–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- **Multiple Threads Peek** - –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### **1. Single Writer, Single Reader**
```cpp
TEST_CASE("single writer single reader")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π - –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –ø–∏—à–µ—Ç, –¥—Ä—É–≥–æ–π —á–∏—Ç–∞–µ—Ç
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** 
- –°–æ–∑–¥–∞–µ—Ç 2 –ø–æ—Ç–æ–∫–∞ (–ø–∏—Å–∞—Ç–µ–ª—å –∏ —á–∏—Ç–∞—Ç–µ–ª—å)
- –ü–∏—Å–∞—Ç–µ–ª—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä
- –ß–∏—Ç–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –±—É—Ñ–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–∑–æ–≤–∞—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### **2. Multiple Writer, Single Reader**
```cpp
TEST_CASE("multiple writer single reader")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–∏—Å–∞—Ç–µ–ª–µ–π –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ –æ–¥–∏–Ω –±—É—Ñ–µ—Ä
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç N –ø–æ—Ç–æ–∫–æ–≤-–ø–∏—Å–∞—Ç–µ–ª–µ–π –∏ 1 –ø–æ—Ç–æ–∫-—á–∏—Ç–∞—Ç–µ–ª—å
- –ö–∞–∂–¥—ã–π –ø–∏—Å–∞—Ç–µ–ª—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ß–∏—Ç–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å –∏ –Ω–µ –∏—Å–∫–∞–∑–∏–ª–∏—Å—å
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±—É—Ñ–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—É—é –∑–∞–ø–∏—Å—å

### **3. Multiple Writer, Multiple Reader**
```cpp
TEST_CASE("multiple writer multiple reader")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ü–æ–ª–Ω–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è - –º–Ω–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª–µ–π –∏ —á–∏—Ç–∞—Ç–µ–ª–µ–π
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç N –ø–∏—Å–∞—Ç–µ–ª–µ–π –∏ M —á–∏—Ç–∞—Ç–µ–ª–µ–π
- –í—Å–µ –ø–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ò–∑–º–µ—Ä—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±—É—Ñ–µ—Ä –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É

### **4. Race Conditions**
```cpp
TEST_CASE("race between skip and read")
TEST_CASE("race between reserve and commit")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ì–æ–Ω–∫–∏ –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç –ø–æ—Ç–æ–∫–∏, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ —Ä–∞–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –Ω–µ—Ç data races
- –£–±–µ–∂–¥–∞–µ—Ç—Å—è, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±—É—Ñ–µ—Ä–∞ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –≥–æ–Ω–æ–∫

### **5. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
```cpp
TEST_CASE("multiple threads reserve and commit")
TEST_CASE("multiple threads peek")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç –º–µ—Å—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç –±—É—Ñ–µ—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ thread-safe

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–ë–∞–∑–æ–≤—ã–π –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π**
```cpp
// –ü–∏—Å–∞—Ç–µ–ª—å
std::thread writer([&] {
    for (int i = 0; i < 1000; ++i) {
        ipc_buffer_write(buffer, &i, sizeof(i));
    }
});

// –ß–∏—Ç–∞—Ç–µ–ª—å  
std::thread reader([&] {
    for (int i = 0; i < 1000; ++i) {
        IpcEntry entry;
        ipc_buffer_read(buffer, &entry);
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        free(entry.payload);
    }
});
```

### **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**
```cpp
// –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç –º–µ—Å—Ç–æ
std::vector<std::thread> threads;
for (int t = 0; t < num_threads; ++t) {
    threads.emplace_back([&, t] {
        void* dest;
        auto result = ipc_buffer_reserve_entry(buffer, size, &dest);
        if (IpcBufferReserveEntryResult_is_ok(result)) {
            // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
            memcpy(dest, data, size);
            ipc_buffer_commit_entry(buffer, result.result);
        }
    });
}
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
–¢–µ—Å—Ç—ã –∏–∑–º–µ—Ä—è—é—Ç:
- **Throughput** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **Latency** - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- **Scalability** - –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤
- **Contention** - –≤–ª–∏—è–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üîç –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **1. Thread Safety**
- –ù–µ—Ç data races
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### **2. Data Integrity**
- –î–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è
- –î–∞–Ω–Ω—ã–µ –Ω–µ –∏—Å–∫–∞–∂–∞—é—Ç—Å—è
- –ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### **3. Performance**
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç
- –ù–µ—Ç deadlocks
- –ù–µ—Ç livelocks

### **4. Error Handling**
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–µ—Ç crash'–µ–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Graceful degradation

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **16 —Ç–µ—Å—Ç–æ–≤** - –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **34,588 assertions** - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω—ã
- **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** - –¥–æ 1000+ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –Ω–µ—Ç race conditions –∏–ª–∏ deadlocks

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
–≠—Ç–∏ —Ç–µ—Å—Ç—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ IPC –±—É—Ñ–µ—Ä—ã –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤:
- **–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö**
- **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö**
- **Real-time —Å–∏—Å—Ç–µ–º–∞—Ö**
- **–°–∏—Å—Ç–µ–º–∞—Ö —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π**
