# IPC Memory Mapping Tests

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
–¢–µ—Å—Ç—ã –¥–ª—è `ipc_mmap.h` - –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å memory mapping –¥–ª—è IPC, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ shared memory —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤.

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–æ–≤
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ memory mapping —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–º—è—Ç—å—é –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ shared memory.

## üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤
**2 —Ç–µ—Å—Ç–∞** - –±–∞–∑–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ memory mapping —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üîß –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### **Memory Mapping Operations**
- `ipc_mmap_create()` - —Å–æ–∑–¥–∞–Ω–∏–µ memory mapped —Å–µ–≥–º–µ–Ω—Ç–∞
- `ipc_mmap_destroy()` - —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ memory mapped —Å–µ–≥–º–µ–Ω—Ç–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

## üß™ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### **1. Different Segment Sizes**
```cpp
TEST_CASE("different segment sizes")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ (1KB, 4KB, 16KB, 64KB, 256KB, 1MB)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–æ–≤
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ memory mapping —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

### **2. Min Segment Size**
```cpp
TEST_CASE("min segment size")
```
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–∞
- –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å
**–ó–∞—á–µ–º:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ memory mapping —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### **–°–æ–∑–¥–∞–Ω–∏–µ memory mapped —Å–µ–≥–º–µ–Ω—Ç–∞**
```cpp
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞
size_t segment_size = 1024 * 1024; // 1MB
IpcMmapResult result = ipc_mmap_create(segment_size);

CHECK(IpcMmapResult_is_ok(result));
CHECK(result.result != nullptr);
CHECK(result.result->size == segment_size);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞
uint8_t* data = (uint8_t*)result.result->ptr;
// –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ shared memory
memset(data, 0xAB, segment_size);

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞
ipc_mmap_destroy(result.result);
```

### **–†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏**
```cpp
// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
const size_t sizes[] = {1024, 4096, 16384, 65536, 262144, 1048576};

for (size_t size : sizes) {
    IpcMmapResult result = ipc_mmap_create(size);
    
    CHECK(IpcMmapResult_is_ok(result));
    CHECK(result.result != nullptr);
    CHECK(result.result->size == size);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏
    uint8_t* ptr = (uint8_t*)result.result->ptr;
    ptr[0] = 0xAA;
    ptr[size-1] = 0xBB;
    
    // –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
    ipc_mmap_destroy(result.result);
}
```

### **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä**
```cpp
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
IpcMmapResult result = ipc_mmap_create(1);

CHECK(IpcMmapResult_is_ok(result));
CHECK(result.result != nullptr);
CHECK(result.result->size == 1);

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
uint8_t* ptr = (uint8_t*)result.result->ptr;
*ptr = 0xCC;

// –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
ipc_mmap_destroy(result.result);
```

## ‚ö° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ memory mapping

### **1. Shared Memory**
- –°–æ–∑–¥–∞–Ω–∏–µ shared memory —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –î–æ—Å—Ç—É–ø –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

### **2. –†–∞–∑–º–µ—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–æ–≤**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
- –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤

### **3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

## üîç –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤

### **2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é**
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–º–µ—Ä–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

### **3. –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ double-free
- –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **2 —Ç–µ—Å—Ç–∞** - –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
- **7 assertions** - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω—ã
- **–ë–∞–∑–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** memory mapping —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–ù–∞–¥–µ–∂–Ω–∞—è –æ—Å–Ω–æ–≤–∞** –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
Memory mapping –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- **Shared memory IPC** - –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
- **Large data transfer** - –ø–µ—Ä–µ–¥–∞—á–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- **Zero-copy operations** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Process communication** - –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
Memory mapping –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å:
- **IPC Buffers** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±—É—Ñ–µ—Ä–æ–≤
- **IPC Channels** - –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- **Shared memory** - –¥–ª—è –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- **Performance optimization** - –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
1. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é
5. **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
